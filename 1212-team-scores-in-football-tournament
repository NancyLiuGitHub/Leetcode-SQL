SELECT team_id, team_name, sum(case when mygoal > othergoal then 3 when mygoal = othergoal then 1 else 0 end) as num_points
FROM (
SELECT host_team as host, guest_team as guest, host_goals as mygoal, guest_goals as othergoal
FROM matches
UNION ALL
SELECT guest_team as host, host_team as guest, host_goals as othergoal, guest_goals as mygoal
FROM matches ) t 
join teams on t.host = teams.team_id
GROUP BY team_id, team_name
