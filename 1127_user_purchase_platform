SELECT spend_date, platform, count(disctinct user_id), sum(total)
FROM (
SELECT spend_date, user_id, MIN(platform) as platform, sum(amount) as total
FROM spending
GROUP BY spend_date, user_id
HAVING COUNT(distinct platform) = 1) t1
GROUP BY 1,2
union
SELECT spend_date, 'both' as platform, count(distinct user_id), sum(total)
FROM (
SELECT spend_date, user_id, sum(amount) as total
FROM spending
GROUP BY spend_date, user_id
HAVING COUNT(distinct platform) = 2 ) t2
GROUP BY 1
